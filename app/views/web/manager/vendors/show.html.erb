<% content_for(:title) { "#{@vendor.name} - Prompt" } %>

<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-900"><%= @vendor.name %></h1>
      <p class="text-sm text-gray-500 mt-1"><%= @vendor.vendor_type&.humanize %></p>
    </div>
    <div class="flex items-center gap-3">
      <%= link_to "Edit", edit_web_manager_vendor_path(@vendor), class: "inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" %>
      <% if @pmv.is_active %>
        <%= button_to "Deactivate", toggle_active_web_manager_vendor_path(@vendor), method: :patch,
            class: "inline-flex items-center px-3 py-2 border border-yellow-300 text-sm font-medium rounded-md text-yellow-700 bg-white hover:bg-yellow-50" %>
      <% else %>
        <%= button_to "Activate", toggle_active_web_manager_vendor_path(@vendor), method: :patch,
            class: "inline-flex items-center px-3 py-2 border border-green-300 text-sm font-medium rounded-md text-green-700 bg-white hover:bg-green-50" %>
      <% end %>
      <%= link_to "Back to Vendors", web_manager_vendors_path, class: "text-sm text-blue-600 hover:text-blue-800" %>
    </div>
  </div>

  <% if flash[:notice] %>
    <div class="mt-4 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg"><%= flash[:notice] %></div>
  <% end %>

  <%# Stats row %>
  <div class="mt-6 grid grid-cols-3 gap-4">
    <div class="bg-white shadow rounded-lg p-5 text-center">
      <p class="text-3xl font-bold text-gray-900"><%= @quotes_received %></p>
      <p class="text-sm text-gray-500 mt-1">Quotes Received</p>
    </div>
    <div class="bg-white shadow rounded-lg p-5 text-center">
      <p class="text-3xl font-bold text-gray-900"><%= @requests_fulfilled %></p>
      <p class="text-sm text-gray-500 mt-1">Jobs Completed</p>
    </div>
    <div class="bg-white shadow rounded-lg p-5 text-center">
      <% if @average_rating %>
        <div class="flex justify-center items-center gap-1 mb-1">
          <% full = @average_rating.floor %>
          <% full.times do %>
            <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
          <% end %>
          <% (5 - full).times do %>
            <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
          <% end %>
        </div>
        <p class="text-2xl font-bold text-gray-900"><%= @average_rating %> <span class="text-sm font-normal text-gray-500">/ 5</span></p>
      <% else %>
        <p class="text-2xl font-bold text-gray-400">—</p>
      <% end %>
      <p class="text-sm text-gray-500 mt-1">Avg. Tenant Rating</p>
    </div>
  </div>

  <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <%# Contact details %>
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-base font-semibold text-gray-900 mb-4">Contact Details</h2>
      <dl class="space-y-3 text-sm">
        <% if @vendor.contact_name.present? %>
          <div>
            <dt class="text-gray-500">Contact</dt>
            <dd class="font-medium text-gray-900"><%= @vendor.contact_name %></dd>
          </div>
        <% end %>
        <div>
          <dt class="text-gray-500">Cell Phone <span class="text-xs text-blue-500">(SMS)</span></dt>
          <dd class="font-medium text-blue-600">
            <a href="tel:<%= @vendor.cell_phone %>"><%= @vendor.cell_phone.presence || "—" %></a>
          </dd>
        </div>
        <% if @vendor.phone_number.present? %>
          <div>
            <dt class="text-gray-500">Office Phone</dt>
            <dd class="font-medium text-gray-900"><a href="tel:<%= @vendor.phone_number %>"><%= @vendor.phone_number %></a></dd>
          </div>
        <% end %>
        <% if @vendor.email.present? %>
          <div>
            <dt class="text-gray-500">Email</dt>
            <dd class="font-medium text-gray-900"><a href="mailto:<%= @vendor.email %>" class="text-blue-600 hover:underline"><%= @vendor.email %></a></dd>
          </div>
        <% end %>
        <% if @vendor.address.present? %>
          <div>
            <dt class="text-gray-500">Address</dt>
            <dd class="font-medium text-gray-900"><%= @vendor.address %></dd>
          </div>
        <% end %>
        <% if @vendor.website.present? %>
          <div>
            <dt class="text-gray-500">Website</dt>
            <dd><a href="<%= @vendor.website %>" target="_blank" class="text-blue-600 hover:underline text-sm"><%= @vendor.website %></a></dd>
          </div>
        <% end %>
        <% if @vendor.notes.present? %>
          <div class="pt-2 border-t border-gray-100">
            <dt class="text-gray-500 mb-1">Private Notes</dt>
            <dd class="text-gray-700 text-sm"><%= @vendor.notes %></dd>
          </div>
        <% end %>
      </dl>
    </div>

    <%# Recent requests %>
    <div class="lg:col-span-2 bg-white shadow rounded-lg p-6">
      <h2 class="text-base font-semibold text-gray-900 mb-4">Recent Requests</h2>
      <% if @recent_requests.any? %>
        <table class="min-w-full divide-y divide-gray-100 text-sm">
          <thead>
            <tr>
              <th class="pb-2 text-left text-xs font-medium text-gray-500 uppercase">Issue</th>
              <th class="pb-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
              <th class="pb-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-50">
            <% @recent_requests.each do |req| %>
              <tr>
                <td class="py-2 text-gray-900"><%= req.issue_type&.humanize %></td>
                <td class="py-2">
                  <span class="inline-flex px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800"><%= req.status&.humanize %></span>
                </td>
                <td class="py-2 text-gray-400"><%= req.created_at.strftime("%b %d, %Y") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-sm text-gray-400">No requests assigned yet.</p>
      <% end %>
    </div>
  </div>
</div>
